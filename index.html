<!DOCTYPE html>
<html lang="en"> <!--Started 30 May-->
<head>
<title>
</title>
<meta charset="UFT-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
</head>
<style>
    .TileDiv{        
        width: 600px;
        display: flex;
        flex-wrap: wrap;
    }
    .tile{
        height: 38px;
        width: 38px;
        border: solid 1px darkblue;
        background-color: aqua;
    }
    .green{
        background-color: green;
    }
    .yellow{
        background-color: yellow;
    }
    .player{
        background-color: red;
    }
    .blue{
        background-color: blue;
    }
    .destroyed{
        background-color: grey;
    }

</style>
<body>
    <h1>Space Invaders</h1>    
    <div id="Tiles" class="TileDiv"></div>
    <button onclick="attack()">Attack</button>
    <div id="Remaining"></div> <!--temp-->
    <button onclick="moveLeft()">Move Left</button>
    <button onclick="moveRight()">Move Right</button>
    <div id="GameOver"></div>
    <button onclick="iden()">Check ID</button>
    <div id="Info"></div> <!--temp-->
    <div id="Lives"></div>
</body>
<script>
let tiles = document.getElementById("Tiles");
let alienAttCountDown = 4;
let info = "";//temp
let moveArray = [];
let gameOver = false;
let alienRow1 = [13,11,9,7,5,3,1];
let alienRow2 = [];
let bunkers = [151,152,155,156,159,160,163,164];
let alive = []
let shipsRemaining = 14; //temp
let ships = 14;
let aFiring = false;
let alienAttackPos = 0;
let cancel = false;
let lives = 3;
let pFiring1 = false;
let pFiring2 = false;
let alienRealPos = alienPos.slice();
let moveL = false;
let moveR = false;
let pFiring = false; //temp
let playerPos = 165;
let attPos = 0;//temp
let attPos1 = 0;
let attPos2 = 0;
let init = 0; //temp
let alienInit = false; //temp

document.getElementById("Info").innerHTML = info;//temp
document.getElementById("Lives").innerHTML = lives;
document.getElementById(`${playerPos}`).classList.add("player");
document.getElementById("Remaining").innerHTML = shipsRemaining; //temp

for (let i=0;i<180;i++){
    let tile = document.createElement('div');
    tile.classList.add('tile')
    tile.id = i;
    tiles.append(tile);        
}

for(let j=0;j<10;j++){
    let b = j*15;
    for(let i=0;i<15;i++){
        if (j%2){
            let a = 14-i;
            a += b;
            moveArray.push(a);    
        }
        else{
            let a = i + b;
            moveArray.push(a);
        }
    }
}
//console.log(moveArray);

for(let i=0;i<7;i++){
    let a = alienRow1[i];
    let b = a + 45;
    alienRow2.push(b);
}

let alienPos = alienRow2.concat(alienRow1);

//console.log(alienPos);

for(let i=0;i<alienPos.length;i++){
    let a = alienPos[i];
    let b = moveArray[a];
    document.getElementById(`${b}`).classList.add("yellow");
    alive.push(true);
}
//console.log(alive);

for(let i=0;i<bunkers.length;i++){
    let a = bunkers[i];
    document.getElementById(`${a}`).classList.add("green");
}    

setTimeout(
    function initial() {
        for(let i=0;i<alienPos.length;i++){
            let a = alienPos[i];
            let p = moveArray[a];
            document.getElementById(`${p}`).classList.remove("yellow");
        }       
},1000);

let alienMove = setInterval(
    function aMove(){         
        let attacker = 0;
        function findAttacker(){
            for(let i=0;i<alive.length;i++){
                if(alive[i]==true){
                    attacker = alienRealPos[i];
                    return;
                }
            }
        }
        
        findAttacker();
       // console.log(attacker);

       info = alienAttCountDown; //temp
        document.getElementById("Info").innerHTML = alienAttCountDown; //temp
        if(aFiring==false&&alienAttCountDown>0){ //alien attack prep
            alienAttCountDown -= 1;
        }         
        if(alienAttCountDown==0){ //alien attack ready
            aFiring = true;            
            console.log("ready");
            alienAttCountDown = 4;
        }

       if(aFiring==true){
            if(alienInit==false){
                alienAttackPos = attacker + 15;
                document.getElementById(`${alienAttackPos}`).classList.add("blue");
                alienInit = true;
            }
            else{
                if(alienAttackPos<1){ //temp
                    alienAttackPos = 1;

                }
                document.getElementById(`${alienAttackPos}`).classList.remove("blue");
                if(alienAttackPos>164){
                    aFiring = false;
                    alienInit = false;
                }
                else{
                alienAttackPos += 15;
                document.getElementById(`${alienAttackPos}`).classList.add("blue");
                }
            }
       // alienAttackPos
       }       

        if(pFiring==true){           
            attPos = playerPos - 15;
            init = attPos + 15;
            if(attPos<150){
                document.getElementById(`${init}`).classList.remove("blue");
            }                 
            if(attPos<0){
                pFiring=false;
                attPos = 0;
                init = 0;
            }
            else{
                document.getElementById(`${attPos}`).classList.add("blue");
                attPos -= 15;   
            }            
        }

        if(pFiring1==true){            
            attPos1 = playerPos - 15;
            //init = attPos + 15;
            if(attPos1<150){
                document.getElementById(`${init}`).classList.remove("blue");
            }                 
            if(attPos1<15){
                pFiring1=false;
                attPos1 = 0;
                //init = 0;
            }
            else{
                document.getElementById(`${attPos1}`).classList.add("blue");
                attPos1 -= 15;   
            }            
        }

        if(alienAttackPos == playerPos){ //player death
            document.getElementById(`${playerPos}`).classList.remove("red");    
            document.getElementById(`${playerPos}`).classList.remove("blue"); 
            aFiring = false;
            death(playerPos);
            lives -= 1;
            alienAttackPos = -1;
            document.getElementById("Lives").innerHTML = lives; 
            if(lives==0){
                    clearInterval(alienMove);                         
                    gameOver = true;
                    document.getElementById("GameOver").innerHTML = "GAME OVER";
            }    
        }

        if(alienRealPos.indexOf(attPos1)!==-1 || alienRealPos.indexOf(attPos2)!==-1){ //alien death
            let i = 0;
            if(alienRealPos.indexOf(attPos1)!==-1){
                i = alienRealPos.indexOf(attPos1); 
                pFiring1 = false;
            }
            if(alienRealPos.indexOf(attPos2)!==-1){
                i = alienRealPos.indexOf(attPos2); 
                pFiring2 = false;
            }
            let area = alienRealPos[i];
               
            document.getElementById(`${area}`).classList.remove("yellow");    
            document.getElementById(`${area}`).classList.remove("blue");   
            alienRealPos[i] = -1;  
            death(area);
            alive[i] = false;      
            
            shipsRemaining -= 1;//temp
            document.getElementById("Remaining").innerHTML = shipsRemaining;//temp
            console.log(shipsRemaining);//temp            
        }        

        if(alienAttackPos==attPos1){ // all bunker deaths
            cancel == true;
            if(bunkers.indexOf(attPos1)!==-1){
                let a = bunkers.indexOf(attPos1);
                bunkers[a] = -1;
                document.getElementById(`${attPos1}`).classList.remove("green");
                death(attPos1); 
            }
            aFiring = false;
            pFiring1 = false;
        }  

        if(alienAttackPos==attPos2){ // all bunker deaths
            cancel == true;
            if(bunkers.indexOf(attPos2)!==-1){
                let a = bunkers.indexOf(attPos2);
                bunkers[a] = -1;
                document.getElementById(`${attPos2}`).classList.remove("green");
                death(attPos2); 
            }
            aFiring = false;
            pFiring2 = false;
        }  
        
        if(bunkers.indexOf(alienAttackPos)!==-1&&cancel==false){
            let a = bunkers.indexOf(alienAttackPos);
            bunkers[a] = -1;
            document.getElementById(`${alienAttackPos}`).classList.remove("green");
            death(alienAttackPos);
            //attPos -= 180;        
            aFiring=false;        
        }
        if(bunkers.indexOf(attPos1)!==-1&&cancel==false){
            let a = bunkers.indexOf(attPos1);
            bunkers[a] = -1;
            document.getElementById(`${attPos1}`).classList.remove("green");
            death(attPos1);
            //attPos -= 180;        
            pFiring1=false;        
        }

        if(bunkers.indexOf(attPos2)!==-1&&cancel==false){
            let a = bunkers.indexOf(attPos2);
            bunkers[a] = -1;
            document.getElementById(`${attPos2}`).classList.remove("green");
            death(attPos2);
            //attPos -= 180;        
            pFiring2=false;        
        }

        if(alive.indexOf(true)==-1){
            clearInterval(alienMove);
            //endGame();      
            gameOver = true;
            document.getElementById("GameOver").innerHTML = "YOU WIN!";
        }

        for(let i=0;i<ships;i++){ //alien move
            if(alive[i]==true){
                let num = alienPos[i];
                let a = moveArray[num];
                let p = num-1;
                let prev = moveArray[p];
                document.getElementById(`${prev}`).classList.remove("yellow");
                document.getElementById(`${a}`).classList.add("yellow");
                alienPos[i] += 1;                
                alienRealPos[i] = a;
                
                if(alienPos[i]>149){
                    clearInterval(alienMove);
                    endGame();      
                    gameOver = true;
                }                    
            }
        }      
        
        if(moveL == true && gameOver == false){ //player move
            document.getElementById(`${playerPos}`).classList.remove("player");
            playerPos -= 1;
            document.getElementById(`${playerPos}`).classList.add("player");
            moveL = false;
        }

        if(moveR == true && gameOver == false){
            document.getElementById(`${playerPos}`).classList.remove("player");
            playerPos += 1;
            document.getElementById(`${playerPos}`).classList.add("player");
            moveR = false;
        } 
        cancel==false; //undoing player and alien hits cancelling each other out
    },1000);

function endGame(){
    let instant = false;
    setTimeout(
        function(){document.getElementById("150").classList.add("blue");
        },1000);
    setTimeout(
        function (){
            if(playerPos == 165){
                document.getElementById(`${playerPos}`).classList.remove("player");
                document.getElementById("165").classList.add("blue");
                instant = true;
            }
            else{
            document.getElementById("165").classList.add("blue");
            }
        },2000);
    setTimeout(
        function (){
            if(instant==false){
                document.getElementById(`${playerPos}`).classList.remove("player");
            }
            for(let i=166;i<180;i++){
                document.getElementById(`${i}`).classList.add("blue");
            }
            document.getElementById("GameOver").innerHTML = "GAME OVER";
        },3000);
}

function death(divNum){
    document.getElementById(`${divNum}`).classList.add("destroyed");
    setTimeout(document.getElementById(`${divNum}`).classList.remove("destroyed"),1000);
}

function moveLeft(){
    if(playerPos>165 && gameOver==false && moveL == false){
        moveL = true;        
    }
}

function moveRight(){
    if(playerPos<179 && gameOver==false && moveR == false){
        moveR = true;        
    }
}

function attack(){
    if(pFiring1 == true){
        if(pFiring2 == true){
            return;
        }
        pFiring2 = true;
        return;
    }
    if(pFiring2 == true){
        pFiring1 = true;
        return;
    }
    pFiring1 = true;
   // attPos = playerPos - 15;
}

function iden(){ //temp
        console.log(alienRealPos);
}

</script>
</html>
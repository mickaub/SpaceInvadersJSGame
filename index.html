<!DOCTYPE html>
<html lang="en"> <!--Started 30 May-->
<head>
<title>
</title>
<meta charset="UFT-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
</head>
<style>
    .TileDiv{        
        width: 600px;
        display: flex;
        flex-wrap: wrap;
    }
    .tile{
        height: 38px;
        width: 38px;
        border: solid 1px darkblue;
        background-color: aqua;
    }
    .green{
        background-color: green;
    }
    .yellow{
        background-color: yellow;
    }
    .player{
        background-color: red;
    }
    .blue{
        background-color: blue;
    }
    .destroyed{
        background-color: grey;
    }

</style>
<body>
    <h1>Space Invaders</h1>    
    <div id="Tiles" class="TileDiv"></div>
    <button onclick="attack()">Attack</button>
    <div id="Remaining"></div> <!--temp-->
    <button onclick="moveLeft()">Move Left</button>
    <button onclick="moveRight()">Move Right</button>
    <div id="GameOver"></div>
    <button onclick="iden()">Check ID</button>
    <div id="Info"></div> <!--temp-->
    <div id="Lives"></div>
</body>
<script>
let tiles = document.getElementById("Tiles");
let info = "";
document.getElementById("Info").innerHTML = info;

let alienAttCountDown = 4;
for (let i=0;i<180;i++){
    let tile = document.createElement('div');
    tile.classList.add('tile')
    tile.id = i;
    tiles.append(tile);        
}
let moveArray = [];
for(let j=0;j<10;j++){
    let b = j*15;
    for(let i=0;i<15;i++){
        if (j%2){
            let a = 14-i;
            a += b;
            moveArray.push(a);    
        }
        else{
            let a = i + b;
            moveArray.push(a);
        }
    }
}
//console.log(moveArray);

/*
new Variables

RandTime = [];

*/

gameOver = false;

let alienRow1 = [13,11,9,7,5,3,1];
let alienRow2 = [];
for(let i=0;i<7;i++){
    let a = alienRow1[i];
    let b = a + 45;
    alienRow2.push(b);
}
let alienPos = alienRow2.concat(alienRow1);
let ships = 14;
let shipsRemaining = 14;
//console.log(alienPos);
let alive = []
let bunkers = [151,152,155,156,159,160,163,164];
//let randAlienTarget = [];
//let rAT2 = [];
//let rATCombined = [];
let aFiring = false;
let alienAttackPos = 0;
let cancel = false;
let lives = 3;

document.getElementById("Lives").innerHTML = lives;

/*for(let i=150;i<165;i++){
    randAlienTarget.push(i);
    rAT2.push(i);
}*/

/*let shuffle = function (array) {
    var currentIndex = array.length;
    var temporaryValue, randomIndex;

    while (0 !== currentIndex) {            
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;            
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
    }        
};

shuffle(randAlienTarget);
shuffle(rAT2);*/
//rATCombined = randAlienTarget.concat(rAT2);
//console.log(rATCombined);

for(let i=0;i<alienPos.length;i++){
    let a = alienPos[i];
    let b = moveArray[a];
    document.getElementById(`${b}`).classList.add("yellow");
    alive.push(true);
}
//console.log(alive);

let playerPos = 165;

document.getElementById(`${playerPos}`).classList.add("player");

function moveLeft(){
    if(playerPos>165 && gameOver==false && moveL == false){
        moveL = true;        
    }
}

function moveRight(){
    if(playerPos<179 && gameOver==false && moveR == false){
        moveR = true;        
    }
}

document.getElementById("Remaining").innerHTML = shipsRemaining;


for(let i=0;i<bunkers.length;i++){
    let a = bunkers[i];
    document.getElementById(`${a}`).classList.add("green");
}    

setTimeout(
    function initial() {
        for(let i=0;i<alienPos.length;i++){
            let a = alienPos[i];
            let p = moveArray[a];
            document.getElementById(`${p}`).classList.remove("yellow");
        }
        aFiring = true;
    },1000);

/*let alienHit = setInterval(
    function alienFire(){
        let front = alive.slice(7);
        let back = alive.slice(-7);
        let sender;
        //console.log(front,back);
        let senderID = Math.floor(Math.random()*7);
        if(front.indexOf(true)==-1){
            sender = alienPos[senderID];
        }
        else{
            let toBack = senderID + 7;
            sender = alienPos[toBack];
        }
        
        /*console.log(sender,(sender%15));

        let a = 150+(sender%15);
        if(bunkers.indexOf(a)==-1){
            document.getElementById(`${a}`).classList.add("blue");
        }
        else{
            document.getElementById(`${a}`).classList.remove("green");
            document.getElementById(`${a}`).classList.add("blue");
        }
       // rATCombined.push(a);
       // rATCombined.shift();      
        
        if(gameOver == true){
            clearInterval(alienHit);
        }
    },4000);*/

let alienRealPos = alienPos.slice();
let moveL = false;
let moveR = false;
let pFiring = false;

let attPos = 0;
let init = 0;
/*
alien attack
player attack
alien death DONE
player death DONE
alien move DONE 
player move DONE
*/
let alienMove = setInterval(
    function aMove(){         
        

       
        

        if(pFiring==true){
           // attPos = playerPos - 15;
            
            init = attPos + 15;
            if(attPos<150){
                document.getElementById(`${init}`).classList.remove("blue");
            }     
            
            if(attPos<0){
                pFiring=false;
                attPos = 0;
                init = 0;
            }
            else{
                document.getElementById(`${attPos}`).classList.add("blue");
                attPos -= 15;   
            }
            
        }

        if(alienAttackPos == playerPos){ //player death
            document.getElementById(`${playerPos}`).classList.remove("red");    
            document.getElementById(`${playerPos}`).classList.remove("blue"); 
            death(playerPos);
            lives -= 1;
            document.getElementById("Lives").innerHTML = lives; 
            if(lives==0){
                    clearInterval(alienMove);                         
                    gameOver = true;
            }    
        }

        if(alienRealPos.indexOf(attPos)!==-1){ //alien death
                let i = alienRealPos.indexOf(attPos);  
                alienRealPos[i] = -1;  
                alive[i] = false;    
                document.getElementById(`${attPos}`).classList.remove("yellow");    
                document.getElementById(`${attPos}`).classList.remove("blue");        
                death(attPos);
                shipsRemaining -= 1;//temp
                document.getElementById("Remaining").innerHTML = shipsRemaining;//temp
                console.log(shipsRemaining);//temp
                pFiring=false;
        }

        info = alienAttCountDown; //temp
        document.getElementById("Info").innerHTML = info; //temp
        if(aFiring==false&&alienAttCountDown>0){ //alien attack prep
            alienAttCountDown -= 1;
        }         
        if(alienAttCountDown==0){ //alien attack ready
            aFiring = true;            
        }

        if(alienAttackPos==attPos){ // all bunker deaths
            cancel == true;
            if(bunkers.indexOf(attPos)!==-1){
                let a = bunkers.indexOf(attPos);
                bunkers[a] = -1;
                document.getElementById(`${attPos}`).classList.remove("green");
                death(attPos); 
            }
            aFiring = false;
            pFiring = false;
        }  
        
        if(bunkers.indexOf(alienAttackPos)!==-1&&cancel==false){
            let a = bunkers.indexOf(attPos);
            bunkers[a] = -1;
            document.getElementById(`${attPos}`).classList.remove("green");
            death(attPos);
            //attPos -= 180;        
            aFiring=false;        
        }
        if(bunkers.indexOf(attPos)!==-1&&cancel==false){
            let a = bunkers.indexOf(attPos);
            bunkers[a] = -1;
            document.getElementById(`${attPos}`).classList.remove("green");
            death(attPos);
            //attPos -= 180;        
            pFiring=false;        
        }
        for(let i=0;i<ships;i++){ //alien move
            if(alive[i]==true){
                let num = alienPos[i];
                let a = moveArray[num];
                let p = num-1;
                let prev = moveArray[p];
                document.getElementById(`${prev}`).classList.remove("yellow");
                document.getElementById(`${a}`).classList.add("yellow");
                alienPos[i] += 1;                
                alienRealPos[i] = a;
                
                if(alienPos[i]>149){
                    clearInterval(alienMove);
                    endGame();      
                    gameOver = true;
                }                    
            }
        }      
        
        if(moveL == true && gameOver == false){ //player move
            document.getElementById(`${playerPos}`).classList.remove("player");
            playerPos -= 1;
            document.getElementById(`${playerPos}`).classList.add("player");
            moveL = false;
        }

        if(moveR == true && gameOver == false){
            document.getElementById(`${playerPos}`).classList.remove("player");
            playerPos += 1;
            document.getElementById(`${playerPos}`).classList.add("player");
            moveR = false;
        } 
        cancel==false; //undoing player and alien hits cancelling each other out
    },1000);

function endGame(){
    let instant = false;
    setTimeout(
        function(){document.getElementById("150").classList.add("blue");
        },1000);
    setTimeout(
        function (){
            if(playerPos == 165){
                document.getElementById(`${playerPos}`).classList.remove("player");
                document.getElementById("165").classList.add("blue");
                instant = true;
            }
            else{
            document.getElementById("165").classList.add("blue");
            }
        },2000);
    setTimeout(
        function (){
            if(instant==false){
                document.getElementById(`${playerPos}`).classList.remove("player");
            }
            for(let i=166;i<180;i++){
                document.getElementById(`${i}`).classList.add("blue");
            }
            document.getElementById("GameOver").innerHTML = "GAME OVER";
        },3000);
}

function death(divNum){
    document.getElementById(`${divNum}`).classList.add("destroyed");
    setTimeout(document.getElementById(`${divNum}`).classList.remove("destroyed"),1000);
}

function iden(){
        console.log(alienRealPos);
}

function attack(){
    pFiring = true;
    attPos = playerPos - 15;
}
   /* let r = Math.floor(Math.random()*ships);
    if(alive[r]==true){
        alive[r]=false;
        let num = alienPos[r];
        let p = num -1;
        let prev = moveArray[p];
        document.getElementById(`${prev}`).classList.remove("yellow");
    }*/
    //console.log(alive);
    function attack2(){
        let attPos = playerPos - 15;
       

        let firePath = setInterval(
        function fireUp(){
            let init = attPos+15;
            
            if(bunkers.indexOf(attPos)!==-1){
                let a = bunkers.indexOf(attPos);
                bunkers[a] = -1;
                document.getElementById(`${attPos}`).classList.remove("green");
                attPos -= 165;                
            }
            if(attPos<150){
                document.getElementById(`${init}`).classList.remove("blue");
            }                                       
            if(alienRealPos.indexOf(attPos)!==-1){
                let h = alienRealPos.indexOf(attPos);    
                alive[h] = false;            
                let num = alienRealPos[h];
                //let p = num -1;
                let prev = moveArray[num];
                document.getElementById(`${prev}`).classList.remove("yellow");           
                attPos -=165;
                num = -1;
            }
            if(attPos<0){                              
                clearInterval(firePath);
            }
            else{
                document.getElementById(`${attPos}`).classList.add("blue");
                attPos -= 15;   
            }
           
        },1000); 
}

    /*
    
        let path = [];
        for(let i=playerPos;i>-1;i-15){
            path.push(i);
        };
        let a = path[0];
        document.getElementById(`${a}`).classList.add("blue");        
        
        let firing = setInterval(
            function fireUp(){
                let a = path[0];
                document.getElementById(`${a}`).classList.add("blue");
                path.shift();
                if(path.length==0){
                    clearInterval(firing);
                }
            }
        ,1000);    */

/*function attack(){ // needs fixing, remove 2 when done
    clearInterval(alienMove);
    let a = moveArray[(alienPos[0]-1)];
    if(a<0){
        a = alienPos;
    }    
    document.getElementById(`${a}`).style.backgroundColor = "red";
    alienPos[0] = 0;
}*/
</script>
</html>